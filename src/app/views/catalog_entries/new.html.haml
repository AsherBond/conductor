= render :partial => 'layouts/admin_nav'
= render :partial => 'section_header'

%section.admin-content-section
  %header
    %h2=t'catalog_entries.new.add_catalog_entry'

%section.admin-content-section.image-upload
  %p.description=t'.choose_option_to_upload'

  %nav#image-upload-tabs.faceted
    %ul.tabs
      %li
        = link_to t('catalog_entries.new.upload'), new_catalog_catalog_entry_path(@catalog), :id => "upload", :class => "#{'selected' if @form_option == 'upload'}"
      %li
        = link_to t('catalog_entries.new.from_url'), new_catalog_catalog_entry_path(@catalog, :from_url => true), :id => "from_url", :class => "#{'selected' if @form_option == 'from_url'}"

    .form_option
      = render :partial => @form_option

:javascript
  $(document).ready(function() {
    $("a#upload").click(function(ev){
      var entry_name = read_name_field();
      var entry_description = read_description_field();
      var $clicked_element = $(this)
      ev.preventDefault();
      $.get('#{new_catalog_catalog_entry_url(@catalog)}', function(data){
        change_selected($clicked_element, $('a#from_url'));
        $('.form_option').empty();
        $('.form_option').html(data).show();
        $('input#catalog_entry_name').val(entry_name);
        $('textarea#catalog_entry_description').val(entry_description);
      });
    });
    $("a#from_url").click(function(ev){
      var entry_name = read_name_field();
      var entry_description = read_description_field();
      var $clicked_element = $(this)
      ev.preventDefault();
      $.get('#{new_catalog_catalog_entry_url(@catalog, :from_url => true)}', function(data){
        change_selected($clicked_element, $("a#upload"));
        $('.form_option').empty();
        $('.form_option').html(data).show();
        $('input#catalog_entry_name').val(entry_name);
        $('textarea#catalog_entry_description').val(entry_description);
      });
    });
  });

  function change_selected($add_selected, $remove_selected){
    $remove_selected.removeClass('selected');
    $add_selected.addClass('selected');
  }

  function read_name_field() {
    if ($('input#catalog_entry_name').val()) {
      return $('input#catalog_entry_name').val();
    }
  }

  function read_description_field() {
    if ($('textarea#catalog_entry_description').val()) {
        return $('textarea#catalog_entry_description').val();
    }
  }