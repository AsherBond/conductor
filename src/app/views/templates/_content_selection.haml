.grid_16
  %h3 Managed Content Selection

  - form_tag :action => "add_software" do
    %fieldset.clearfix
      .search.grid_4.alpha
        %input{:type => "search", :placeholder => "Search for package", :disabled => "disabled"}
        %button.action
      = hidden_field_tag :template_id, @tpl.id
      .grid_8
        %p
          Repositories to Search:
          %a (Check all)
        %fieldset
          - @repository_manager.repositories.each do |repo|
            = check_box_tag 'repositories[]', repo.id, true
            = label_tag 'repositories[]', repo.name
      %a.grid_4.omega Advanced Search
    -#%fieldset.clearfix
    -#  .grid_3.alpha
    -#    = radio_button_tag :show_mode, 'group', true
    -#    = label_tag :show_mode, 'Show by Group'
    -#  .grid_2.omega
    -#    = radio_button_tag :show_mode, 'type', false, :disabled => true
    -#    = label_tag :show_mode, 'Show by Type'

    -#%fieldset.clearfix
    -#  = submit_tag "Add Selected", :name => "add_selected", :class => "grid_2 alpha", :id => "do_add_software"
    -#  = submit_tag "Cancel", :name => "cancel", :class => "grid_2", :id => "cancel_add_software"
    %ul.softwaregroups
      - groups = @groups.keys.sort
      - unsorted = groups.delete('unsorted')
      - groups.push('unsorted') if params[:show_unsorted] and unsorted
      - groups.each do |group|
        - group_sel = @groups[group][:selected]
        - group_id = group.gsub(/\s/, '_')
        %li
          = check_box_tag 'groups[]', group, group_sel, :disabled => group_sel, :id => "group_#{group_id}"
          %label.disclosure
            =group
          %ul{:class => "packages group_#{group_id}"}
            - pkgs = @groups[group][:packages]
            - pkgs.keys.sort.each do |pkg|
              - pkg_sel = pkgs[pkg][:selected] ? true : false
              - pkg_id = pkg.gsub(/\s/, '_')
              %li
                = check_box_tag 'packages[]', pkg, pkg_sel, :disabled => pkg_sel, :id => "package_#{pkg_id}"
                = label_tag "package_#{pkg_id}", pkg

      = link_to "Show unsorted packages", {:action => 'create', :add_software_form => true, :show_unsorted => true, 'tpl[id]' => @tpl.id}, {:id => 'switch_all_link'} unless params[:show_unsorted]
    %fieldset.clearfix
      = submit_tag "Add Selected", :name => "add_selected", :class => "grid_2 alpha", :id => "do_add_software"
      = submit_tag "Cancel", :name => "cancel", :class => "grid_2", :id => "cancel_add_software"
